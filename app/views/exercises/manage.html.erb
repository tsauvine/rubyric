<!-- exercises/manage.html.erb -->

<h1>
  <%= "#{h @course.code} #{h @course.name}" %> -
  <%= "#{h @course_instance.name}" %> -
  <%= h @exercise.name %>
</h1>

<p><strong>Submit url: </strong><%= link_to submit_url(@exercise.id), submit_url(@exercise.id) %> <span class="hint">- Publish this link on the homepage of the course.</span></p>

<p>
  <b>Deadline:</b>
  <% if @exercise.deadline.blank? %>
    <%= link_to 'No deadline set', edit_exercise_path(@exercise), :class => 'warning' %>
  <% else %>
    <%=l @exercise.deadline, :format => :short %>
  <% end %>
</p>

<h2>Submissions</h2>

<%= form_tag assign_exercise_path(@exercise), :id => 'submissions_form' %>
  <%= hidden_field_tag :eid, params[:id] # exercise id for ajax calls
  %>

  <table class="assignments">
    <thead>
      <tr>
        <td>Submission</td>
        <td>Review</td>
        <td>Status</td>
        <td>Grade</td>
      </tr>
    </thead>
    <tbody id="submissions_table">
      <%= render :partial => 'group', :collection => @groups %>
    </tbody>
    <tfoot>
      <tr>
        <td>
          <input type='submit' value='Select all' onClick="$$('#submissions_form input.submission_check').each(function(box){box.checked=true});return false;" title="Selects all submissions" />
          <input type='submit' value='Select latest' onClick="$$('#submissions_form input.submission_check_latest').each(function(box){box.checked=true});return false;" title="Selects the latest submission from each group" />
          <input type='submit' value='Select none' onClick="$$('#submissions_form input.submission_check').each(function(box){box.checked=false});return false;" />
        </td>
        <td>
          <input type='submit' value='Select all' onClick="$$('#submissions_form input.review_check').each(function(box){box.checked=true});return false;" />
          <input type='submit' value='Select finished' onClick="$$('#submissions_form input.review_check_finished').each(function(box){box.checked=true});return false;" />
          <input type='submit' value='Select none' onClick="$$('#submissions_form input.review_check').each(function(box){box.checked=false});return false;" />
        </td>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <td>
          <p>
          Assign selected submissions to<br />
          <%= select_tag 'assistant', options_for_select(@graders, :selected => nil) %>
          <%= submit_tag 'Assign', :name => 'assign' %>
          </p>
          <p><%= link_to 'Batch assign', batch_assign_exercise_path(@exercise) %></p>
        </td>
        <td>
          <p><%= submit_tag 'Mail selected reviews', :name => 'mail', :confirm => 'Feedback mails will be sent to the students.' %></p>
          <p><%= submit_tag 'Delete selected reviews', :name => 'delete', :confirm => 'Delete selected reviews?' %></p>
        </td>
      </tr>
    </tfoot>
  </table>
</form>


<h2>Workload</h2>

<table>
  <thead>
    <tr>
      <th>Grader</th>
      <th>Reviews</th>
    </tr>
  </thead>
  <tbody>
    <% @grader_workload.each do |workload| %>
      <tr>
        <td><%= h workload[0].name %></td>
        <td><%= workload[1] %></td>
      </tr>
    <% end %>
  </tbody>
</table>

